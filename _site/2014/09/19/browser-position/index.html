<!DOCTYPE html>
<html>


<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="black" name="apple-mobile-web-app-status-bar-style" />
	<meta content="width=device-width; initial-scale=1.0" name="viewport" />
	<title>屌丝的福音.定位女神在哪里</title>
	<meta name="keywords" content="屌丝的福音,浏览器定位,女神在哪里,定位女神,webkit,chrome,safari" />
	<meta name="description" content="屌丝的福音,浏览器定位,女神在哪里,定位女神" />
	<meta name="author" content="jcore" />
	<link rel="shortcut icon" href="/favicon.ico" />
	
	<link rel="stylesheet" type="text/css" href="/resources/css/reset.css">
	<link rel="stylesheet" type="text/css" href="/resources/css/index.css">
    <link rel="stylesheet" type="text/css" href="/resources/css/prettify.css">

	<script type="text/javascript" src="http://cdn.bootcss.com/jquery/2.0.1/jquery.min.js"></script>
	<script type="text/javascript" src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
</head>

<body>

    <div class="header cl">
        <h1>
            <a href="/"><img src="/resources/images/base/logonew2.png" width="100" height="30"></a>
        </h1>
        <!--div class="login">
            <a href="#">登录</a>
        </div-->
        <ul class="nav">
            <li><a class="on" href="/">首&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;页</a></li>
            <!-- 公共用菜单 -->
            <li><a href="#">技术专区</a></li>
<li><a href="#">日志随笔</a></li>
<li><a href="/reading/">阅读书籍</a></li>
<!--li><a href="#">常用资源</a></li-->
<li><a href="/time/">时光轴</a></li>
<li><a href="/guest/">留言板</a></li>
<!--li><a href="/about/">个人介绍</a></li-->
        </ul>
        <a class="pos-nav" href="#">菜单</a>
    </div>

<!-- 主体 -->
<div class="main">
    <div class="main-l">
        <!-- 搜索 -->
        <div class="widget">
    <form action="/pages/" method="get" >
        <input name="q" type="text" id="searchbar" class="fl" value="" placeholder="搜索" />
        <input type="submit" id="searchsubmit" class="fl" value="提交" />
    </form>
</div>
        <!-- 编码经验 -->
        <div class="widget">
    <h2 class="member">编码经验</h2>
    <div class="item-avatar mymembers">
        <ul>
            <img alt="Java" title="Java" src="/resources/images/coding/java.png">

            <img alt="Oracle" title="Oracle" src="/resources/images/coding/oracle.png">
            <img alt="MySQL" title="MySQL" src="/resources/images/coding/mysql.png">

            <img alt="Bash" title="Bash" src="/resources/images/coding/bash.png">
            <img alt="Python" title="Python" src="/resources/images/coding/python.png">

            <img alt="Nginx" title="Nginx" src="/resources/images/coding/nginx.png">
            <img alt="Apache" title="Apache" src="/resources/images/coding/apache.png">
            <img alt="Redis" title="Redis" src="/resources/images/coding/redis.png">
            <img alt="MongoDB" title="MongoDB" src="/resources/images/coding/mongodb.png">

            <img alt="Git" title="Git" src="/resources/images/coding/git.png">
            <img alt="HTML" title="HTML" src="/resources/images/coding/html5.png">
            <img alt="Javascript" title="Javascript" src="/resources/images/coding/javascript.png">
            <img alt="Node" title="Node" src="/resources/images/coding/node.png">
            <img alt="CSS" title="CSS" src="/resources/images/coding/css3.png">
        </ul>
    </div>
</div>
        <!-- 归类统计 -->
        <div class="widget">
    <h2 class="member">分类统计</h2>
    <div class="item-avatar dates">
        <ul>
            
            
            
                
                <a href="/categories/#life"><li><span class="community-count">9</span>life</li><a>
            
                
                <a href="/categories/#html5"><li><span class="community-count">8</span>html5</li><a>
            
                
                <a href="/categories/#javascript"><li><span class="community-count">4</span>javascript</li><a>
            
                
                <a href="/categories/#browser"><li><span class="community-count">3</span>browser</li><a>
            
                
                <a href="/categories/#architect"><li><span class="community-count">3</span>architect</li><a>
            
                
                <a href="/categories/#shell"><li><span class="community-count">2</span>shell</li><a>
            
                
                <a href="/categories/#mac"><li><span class="community-count">2</span>mac</li><a>
            
                
                <a href="/categories/#jekyll"><li><span class="community-count">1</span>jekyll</li><a>
            
                
                <a href="/categories/#install"><li><span class="community-count">1</span>install</li><a>
            
        </ul>
    </div>
    <h2 class="member"></h2>
    <div class="item-avatar dates">
        <ul>
            <a href="/pages/"><li><span class="community-count">33</span>总文章数</li></a>
        </ul>
    </div>
</div>

        <!-- 最近访问 -->
        <div class="widget">
                <h2 class="member">最近访问</h2>
                <div class="item-avatar mymembers">
					<ul class="ds-recent-visitors" data-num-items="20" ></ul>
                </div>
            </div>
        <!-- 友情链接 -->
        <div class="widget">
                <h2 class="member">友情链接</h2>
                <ul class="links">
                    <li><a href="http://www.sentsin.com/" target="_blank">闲心</a></li>
                    <li><a href="http://www.ido321.com/" target="_blank">淡忘~浅思</a></li>
                </ul>
            </div>
    </div>
    <div class="main-m">
        <!-- 1-2两列详情页 -->
        <div class="main-m3-cont main-g-2  radius-top">
    <h1 class="main-m3-h1">屌丝的福音.定位女神在哪里</h1>
    <div class="mini-icon">
        <span>
            <i class="fa fa-user"></i>
            张嘉杰.原创
        </span>
        <span>
            <i class="fa fa-calendar"></i>
            2014-09-19
        </span>
        <span>
            <i class="fa fa-folder-open"></i>
            <a href="/categories.html#browser">browser</a>
        </span>
        <span>
            <i class="fa fa-comments"></i>
            <a href="#ds-reset"><span class="ds-thread-count" data-thread-key="/2014/09/19/browser-position" ></span></a>
        </span>
    </div>
    <div class="contents">
        <p>周五下班回家路上，接到了一位很久未联系的朋友打过来的电话（省略一些敏感话题），切入主题：哥们儿想知道自己的女神住哪儿，又不方便直接问。我想到了一个自己在<code>2012</code>年做项目的时候，使用过的一个方法，在这里分享给需要的朋友。
<!--more--></p>

<blockquote>
  <p>实现思路： </p>
</blockquote>

<div class="highlight"><pre><code class="language-html" data-lang="html">1. 设计美观界面。  
2. 让女神访问固定地址，获取其IP、经度、纬度。  
3. 获取成功，触发邮件至139邮箱（设置短信提醒）。
4. 通过短信返回URL地址，访问地图标出精确位置。</code></pre></div>

<blockquote>
  <p>使用技术：</p>
</blockquote>

<div class="highlight"><pre><code class="language-html" data-lang="html">+-----------+---------+-------------------------+
|  Project  | Version |       Description       |
+-----------------------------------------------+
|  jQuery   | 1.11.1  |  javaScript Framework   |
+-----------------------------------------------+
| MailChimp |   1.0   |     Mail Providers      |
+-----------------------------------------------+
| Map Baidu |   2.0   |     Map Providers       |
+-----------------------------------------------+
|Geolocation|  html5  |     Geolocation api     |
+-----------+---------+-------------------------+</code></pre></div>

<blockquote>
  <p>技术介绍：</p>
</blockquote>

<p><a href="http://jquery.com/">jQuery</a> 具体就不说啦 大家可以去官网方站。  </p>

<p><a href="http://developer.baidu.com/map/">百度地图API</a> 用的是javascript API大众版。    </p>

<p><a href="http://mandrillapp.com/">Mail_Mandrill</a> 支持html5新属性的浏览器（IE9以下的还是放弃吧）。  </p>

<p>139邮箱需要设置邮件短信提醒功能。  </p>

<p>免费的<code>邮件服务</code>有很多，像 <a href="http://mandrillapp.com/">Mail_Mandrill</a>、<a href="http://www.mailgun.com/">Mail_Mailgun</a>、<a href="http://sendcloud.sohu.com/">Mail_SOHO</a>。 主要说下 <a href="http://mandrillapp.com/">Mail_Mandrill</a> ，参考文档：<a href="https://mandrillapp.com/api/docs/messages.JSON.html">Api_Mail_Mandrill</a>，注册过程看图。  </p>

<p>Mandrill 注册账号：  </p>

<p><img src="/resources/images/2014/09/19/browser-position-0.jpg" alt="Mail_Mandrill_0" />  </p>

<p>Mandrill 获取API：  </p>

<p><img src="/resources/images/2014/09/19/browser-position-1.jpg" alt="Mail_Mandrill_1" />  </p>

<p>Mandrill 创建API keys：  </p>

<p><img src="/resources/images/2014/09/19/browser-position-2.jpg" alt="Mail_Mandrill_2" />  </p>

<blockquote>
  <p>HTML5 Geolocation API的使用方法及实现原理</p>
</blockquote>

<p>女神访问页面脚本：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Goddess</span> <span class="o">=</span> <span class="p">{</span>
    <span class="cm">/** 防止重复 */</span>
    <span class="nx">repeat</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="cm">/** 初始化 */</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">repeat</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">this</span><span class="p">.</span><span class="nx">gps</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mail</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">sendMail</span><span class="p">({</span> <span class="nx">subject</span> <span class="o">:</span> <span class="nx">mail</span><span class="p">.</span><span class="nx">subject</span><span class="p">,</span> <span class="nx">html</span> <span class="o">:</span> <span class="nx">mail</span><span class="p">.</span><span class="nx">html</span> <span class="p">});</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">repeat</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
           <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="cm">/** 获取gps经度纬度坐标 */</span>
    <span class="nx">gps</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callfun</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//判断浏览器是否支持geolocation</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nx">address</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">position</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">lon</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">;</span> <span class="c1">//经度</span>
                <span class="kd">var</span> <span class="nx">lat</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">;</span>  <span class="c1">//纬度</span>

                <span class="k">if</span><span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">address</span><span class="p">){</span>  <span class="c1">//是否支持address属性</span>
                    <span class="c1">//通过address，可以获得国家、省份、城市</span>
                    <span class="kd">var</span> <span class="nx">_a</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">address</span><span class="p">;</span>
                    <span class="nx">address</span> <span class="o">=</span>  <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">_a</span><span class="p">.</span><span class="nx">country</span> <span class="o">+</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">province</span> <span class="o">+</span> <span class="nx">_a</span><span class="p">.</span><span class="nx">city</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">message</span> <span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;lat=&quot;</span> <span class="o">+</span> <span class="nx">lat</span> <span class="o">+</span> <span class="s2">&quot;&amp;lon=&quot;</span> <span class="o">+</span> <span class="nx">lon</span> <span class="p">);</span>
                <span class="nx">callfun</span><span class="p">({</span>
                    <span class="nx">tip</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="nx">subject</span> <span class="o">:</span> <span class="s2">&quot;女神地址获取成功，速速查看^0^...&quot;</span><span class="p">,</span>
                    <span class="nx">html</span> <span class="o">:</span> <span class="s2">&quot;&lt;a href=\&quot;http://jcore.cn/getaddress.html?&quot;</span><span class="o">+</span><span class="nx">message</span><span class="o">+</span><span class="s2">&quot;\&quot; target=\&quot;_blank\&quot; &gt;戳我...&quot;</span><span class="o">+</span> <span class="nx">address</span> <span class="o">+</span><span class="s2">&quot;&lt;/a&gt;&quot;</span>
                <span class="p">});</span>

            <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="p">{</span> <span class="c1">//转义友好提示</span>
                    <span class="mi">1</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;这里转义友好提示.[1]&#39;</span><span class="p">,</span> <span class="s2">&quot;女神拒绝提供地理位置（自己想办法咯）&quot;</span><span class="p">],</span>
                    <span class="mi">2</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;这里转义友好提示.[2]&#39;</span><span class="p">,</span> <span class="s2">&quot;获取不到女神位置信息（爱莫能助啊）&quot;</span><span class="p">],</span>
                    <span class="mi">3</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;这里转义友好提示.[3]&#39;</span><span class="p">,</span> <span class="s2">&quot;超时（多访问几次，或者过段时间再次尝试）&quot;</span><span class="p">]</span>
                <span class="p">}</span>
                <span class="kd">var</span> <span class="nx">tip</span> <span class="o">=</span> <span class="nx">type</span><span class="p">[</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="p">];</span>
                <span class="nx">alert</span><span class="p">(</span><span class="nx">tip</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="nx">message</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;获取数据失败：&#39;</span> <span class="o">+</span> <span class="nx">tip</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
                <span class="nx">callfun</span><span class="p">({</span>  <span class="c1">//失败也发送错误提醒</span>
                    <span class="nx">tip</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="nx">subject</span> <span class="o">:</span> <span class="s2">&quot;女神地址获取失败，不哭不哭T_T...&quot;</span><span class="p">,</span>
                    <span class="nx">html</span> <span class="o">:</span> <span class="nx">message</span>
                <span class="p">});</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="cm">/** 发送邮件 */</span>
    <span class="nx">sendMail</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mail</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mail</span><span class="p">.</span><span class="nx">subject</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">mail</span><span class="p">.</span><span class="nx">html</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="c1">//jQuery发送请求</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
            <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;https://mandrillapp.com/api/1.0/messages/send.json&quot;</span><span class="p">,</span> <span class="c1">//json接口地址</span>
            <span class="nx">data</span><span class="o">:</span><span class="p">{</span>
                <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;xuMao7xRBKlImfxtfl3IlA&quot;</span><span class="p">,</span> <span class="c1">//服务允许key</span>
                <span class="s2">&quot;message&quot;</span><span class="o">:</span><span class="p">{</span>
                    <span class="s2">&quot;from_email&quot;</span><span class="o">:</span> <span class="s2">&quot;zj7687362@gmail.com&quot;</span><span class="p">,</span> <span class="c1">//发送邮件地址</span>
                    <span class="s2">&quot;to&quot;</span><span class="o">:</span> <span class="p">[</span> <span class="c1">//发送信息(可多个同时发送)</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;zhangjiajie1314@139.com&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;张嘉杰&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;to&quot;</span>
                        <span class="p">}</span>
                    <span class="p">],</span>
                    <span class="s2">&quot;subject&quot;</span><span class="o">:</span> <span class="nx">mail</span><span class="p">.</span><span class="nx">subject</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="c1">//邮件标题</span>
                    <span class="s2">&quot;html&quot;</span><span class="o">:</span> <span class="nx">mail</span><span class="p">.</span><span class="nx">html</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span> <span class="c1">//邮件内容</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;成功咯.&quot;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>接收显示页面脚本：</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">function</span> <span class="nx">load_script</span><span class="p">(</span><span class="nx">xyUrl</span><span class="p">,</span> <span class="nx">callback</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">xyUrl</span><span class="p">;</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">script</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s2">&quot;loaded&quot;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s2">&quot;complete&quot;</span><span class="p">)){</span>
                <span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">();</span>
                <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">script</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span> <span class="nx">head</span> <span class="o">&amp;&amp;</span> <span class="nx">script</span><span class="p">.</span><span class="nx">parentNode</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nx">head</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span> <span class="nx">script</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">head</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span> <span class="nx">script</span><span class="p">,</span> <span class="nx">head</span><span class="p">.</span><span class="nx">firstChild</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">translate</span><span class="p">(</span><span class="nx">point</span><span class="p">,</span><span class="nx">type</span><span class="p">,</span><span class="nx">callback</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">callbackName</span> <span class="o">=</span> <span class="s1">&#39;cbk_&#39;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">);</span>	<span class="c1">//随机函数名</span>
        <span class="kd">var</span> <span class="nx">xyUrl</span> <span class="o">=</span> <span class="s2">&quot;http://api.map.baidu.com/ag/coord/convert?&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;from=&quot;</span><span class="o">+</span> <span class="nx">type</span> <span class="o">+</span>
                    <span class="s2">&quot;&amp;to=4&quot;</span> <span class="o">+</span>
                    <span class="s2">&quot;&amp;x=&quot;</span> <span class="o">+</span> <span class="nx">point</span><span class="p">.</span><span class="nx">lng</span> <span class="o">+</span>
                    <span class="s2">&quot;&amp;y=&quot;</span> <span class="o">+</span> <span class="nx">point</span><span class="p">.</span><span class="nx">lat</span> <span class="o">+</span>
                    <span class="s2">&quot;&amp;callback=BMap.Convertor.&quot;</span> <span class="o">+</span> <span class="nx">callbackName</span><span class="p">;</span>
        <span class="c1">//动态创建script标签</span>
        <span class="nx">load_script</span><span class="p">(</span><span class="nx">xyUrl</span><span class="p">);</span>
        <span class="nx">BMap</span><span class="p">.</span><span class="nx">Convertor</span><span class="p">[</span><span class="nx">callbackName</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xyResult</span><span class="p">){</span>
            <span class="k">delete</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Convertor</span><span class="p">[</span><span class="nx">callbackName</span><span class="p">];</span>	<span class="c1">//调用完需要删除改函数</span>
            <span class="kd">var</span> <span class="nx">point</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nx">xyResult</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">xyResult</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
            <span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">BMap</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">BMap</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">BMap</span><span class="p">.</span><span class="nx">Convertor</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">BMap</span><span class="p">.</span><span class="nx">Convertor</span><span class="p">.</span><span class="nx">translate</span> <span class="o">=</span> <span class="nx">translate</span><span class="p">;</span>
<span class="p">})();</span>
<span class="c1">//获取URL参数</span>
<span class="kd">function</span> <span class="nx">getQueryStringRegExp</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">reg</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;(^|\\?|&amp;)&quot;</span><span class="o">+</span> <span class="nx">name</span> <span class="o">+</span><span class="s2">&quot;=([^&amp;]*)&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">reg</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">))</span>
        <span class="k">return</span> <span class="nx">unescape</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">.</span><span class="nx">$2</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\+/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">));</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">lon</span> <span class="o">=</span> <span class="nx">getQueryStringRegExp</span><span class="p">(</span><span class="s1">&#39;lon&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">lat</span> <span class="o">=</span> <span class="nx">getQueryStringRegExp</span><span class="p">(</span><span class="s1">&#39;lat&#39;</span><span class="p">);</span>
<span class="c1">// 百度地图API功能</span>
<span class="kd">var</span> <span class="nx">gpsPoint</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nx">lon</span><span class="p">,</span><span class="nx">lat</span><span class="p">);</span>
<span class="c1">//地图初始化</span>
<span class="kd">var</span> <span class="nx">bm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Map</span><span class="p">(</span><span class="s2">&quot;allmap&quot;</span><span class="p">);</span>
<span class="nx">bm</span><span class="p">.</span><span class="nx">centerAndZoom</span><span class="p">(</span><span class="nx">gpsPoint</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
<span class="nx">bm</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">NavigationControl</span><span class="p">());</span>
<span class="c1">//坐标转换完之后的回调函数</span>
<span class="kd">var</span> <span class="nx">translateCallback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">point</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">marker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Marker</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
    <span class="nx">bm</span><span class="p">.</span><span class="nx">addOverlay</span><span class="p">(</span><span class="nx">marker</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">label</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Label</span><span class="p">(</span><span class="s2">&quot;亲，女神的位置哦&quot;</span><span class="p">,{</span><span class="nx">offset</span><span class="o">:</span><span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Size</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">)});</span>
    <span class="nx">marker</span><span class="p">.</span><span class="nx">setLabel</span><span class="p">(</span><span class="nx">label</span><span class="p">);</span> <span class="c1">//添加百度label</span>
    <span class="nx">bm</span><span class="p">.</span><span class="nx">setCenter</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">lng</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">point</span><span class="p">.</span><span class="nx">lat</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="k">new</span> <span class="nx">BMap</span><span class="p">.</span><span class="nx">Convertor</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">gpsPoint</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">translateCallback</span><span class="p">);</span>	 <span class="c1">//真实经纬度转成百度坐标</span>
<span class="p">},</span> <span class="mi">2000</span><span class="p">);</span> <span class="c1">//延迟2秒执行</span></code></pre></div>

<blockquote>
  <p>演示操作流程截图：(演示使用iphone5s默认浏览器Safari)</p>
</blockquote>

<p>女神初次访问地址未开权限提示：（记得修改友好提示）</p>

<p><img src="/resources/images/2014/09/19/browser-position-3.jpg" alt="Goddess_0" />  </p>

<p>打开浏览器Safari定位服务：</p>

<p><img src="/resources/images/2014/09/19/browser-position-4.jpg" alt="Goddess_1" />  </p>

<p>允许使用当前位置：</p>

<p><img src="/resources/images/2014/09/19/browser-position-5.jpg" alt="Goddess_2" />  </p>

<p>根据短信提供地址，得到下图：  </p>

<p><img src="/resources/images/2014/09/19/browser-position-6.jpg" alt="Goddess_3" />   </p>

<h2 id="demo-">到这里基本就完成了。后期补上demo :)</h2>

<hr />

<p>相关文档地址：</p>

<p>Geolocation-API - <a href="http://www.htmq.com/geolocation/">http://www.htmq.com/geolocation/</a><br />
百度地图API - <a href="http://developer.baidu.com/map/">http://developer.baidu.com/map/</a><br />
jQuery - <a href="http://jquery.com/">http://jquery.com/</a><br />
Mail_SOHO - <a href="http://sendcloud.sohu.com/">http://sendcloud.sohu.com/</a><br />
Mail_Mailgun - <a href="http://www.mailgun.com/">http://www.mailgun.com/</a><br />
Mail_Mandrill - <a href="http://mandrillapp.com/">http://mandrillapp.com/</a><br />
Api_Mail_Mandrill - <a href="https://mandrillapp.com/api/docs/messages.JSON.html">https://mandrillapp.com/api/docs/messages.JSON.html</a>  </p>

<hr />



        <div class="detail-ud" >
            
                <p>上一篇:<a href="/2014/09/16/html5-series-webdb" ><b class="mobile-ignore">&nbsp;&nbsp;html5系列.存储</b></a></p>
            
            
                <p>下一篇:<a href="/2014/09/29/architect-build-high-live" ><b class="mobile-ignore">&nbsp;&nbsp;架构实践.高负载高并发电商网站</b></a></p>
            
        </div>
    </div>




    <div class="more-article">
        <span class="fenx">分享文章到：</span>
        <div class="bdsharebuttonbox fl bdshare-button-style0-32" data-bd-bind="1414306729753"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_hi" data-cmd="hi" title="分享到百度空间"></a></div>
        <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin","douban","hi"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin","douban","hi"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
    </div>
    <div class="more-article new-article">
        <h3>热门推荐文章</h3>
        <div class="pics-cont main-g-2-cont">

            
                <dl>
                    <dt><a href="/2014/09/19/browser-position"><img src="/resources/images/2014/09/19/browser-position.png" width="138" height="105" data-bd-imgshare-binded="1"></a></dt>
                    <dd><a href="/2014/09/19/browser-position">屌丝的福音.定位女神在哪里</a></dd>
                </dl>
            
                <dl>
                    <dt><a href="/2013/03/10/browser-webkit"><img src="/resources/images/2013/03/10/browser-webkit.png" width="138" height="105" data-bd-imgshare-binded="1"></a></dt>
                    <dd><a href="/2013/03/10/browser-webkit">关于webkit内核浏览器</a></dd>
                </dl>
            
                <dl>
                    <dt><a href="/2013/01/03/browser-chrome-console"><img src="/resources/images/2013/01/03/browser-chrome-console.png" width="138" height="105" data-bd-imgshare-binded="1"></a></dt>
                    <dd><a href="/2013/01/03/browser-chrome-console">Chrome DevTools之Console</a></dd>
                </dl>
            

        </div>
    </div>
    <div class="more-article">
        <div class="detail-xg p10">
            <div class="ds-thread" data-thread-key="/2014/09/19/browser-position" data-title="屌丝的福音.定位女神在哪里" id="ds-thread"></div>
        </div>
    </div>
</div>
    </div>
</div>

<!-- 页底 -->
    <div class="foot">
        <div class="foot-cont cl">
            <div class="foot-conta footer-fifth">
                <a href="/"><img src="/resources/images/base/bokelogo1.jpg"  width="200" height="60"></a>
                <p>努力的人还是有机会的...</p>
            </div>
            <div class="font-widget footer-fifth foot-contb">
                <h2>最新文章</h2>
                <ul>
                    
                        <li><a href="/2014/10/24/javascript-game-map45">javascript进阶.游戏.斜45度地图拼接</a></li>
                    
                        <li><a href="/2014/10/22/html5-series-game-dahua">html5系列.画布进阶.游戏.人物移动（媚灵狐）</a></li>
                    
                        <li><a href="/2014/10/20/javascript-callback-hell">javascript进阶.callback回调地狱</a></li>
                    
                        <li><a href="/2014/10/19/first-game">话.比赛第一,友谊第二</a></li>
                    
                        <li><a href="/2014/10/18/cycling-miaofengshan">骑行笔记.妙峰山</a></li>
                    
                </ul>
            </div>
            <div class="font-widget footer-fifth foot-contc">
                <h2>推荐网站</h2>
                <ul>
                    <li><a href="http://www.iteye.com/">IT EYE</a> </li>
                    <li><a href="http://www.oschina.net/">中国开源</a> </li>
                    <li><a href="https://ruby-china.org/">Ruby China</a> </li>
                    <li><a href="https://github.com/">Github</a> </li>
                    <li><a href="#">关于我们</a> </li>
                </ul>
            </div>
            <div class="font-widget footer-fifth foot-contd">
                <h2>网站标签</h2>
                <ul>
                    




    
    
        
            <li>
        

        
        <a href="/tags/#html5">html5</a>

        
    

    
    
        

        
        <a href="/tags/#mac">mac</a>

        
    

    
    
        

        
        <a href="/tags/#javascript">javascript</a>

        
            </li>
        
    

    
    
        
            <li>
        

        
        <a href="/tags/#linux">linux</a>

        
    

    
    
        

        
        <a href="/tags/#在线选座">在线选座</a>

        
    

    
    
        

        
        <a href="/tags/#北漂">北漂</a>

        
            </li>
        
    

    
    
        
            <li>
        

        
        <a href="/tags/#chrome">chrome</a>

        
    

    
    
        

        
        <a href="/tags/#webkit">webkit</a>

        
    

    
    
        

        
        <a href="/tags/#shell">shell</a>

        
            </li>
        
    

    
    
        
            <li>
        

        
        <a href="/tags/#game">game</a>

        
    

    
    
        

        
        <a href="/tags/#console">console</a>

        
    

    
    
        

        
        <a href="/tags/#高效率">高效率</a>

        
            </li>
        
    

    
    
        
            <li>
        

        
        <a href="/tags/#高并发">高并发</a>

        
    

    
    
        

        
        <a href="/tags/#骑行">骑行</a>

        
    

    
    
        

        
        <a href="/tags/#架构">架构</a>

        
            </li>
        
    

    
    
        
            <li>
        

        
        <a href="/tags/#媚灵狐">媚灵狐</a>

        
    

    
    
        

        
        <a href="/tags/#大话西游">大话西游</a>

        
    

    
    
        

        
        <a href="/tags/#多线程">多线程</a>

        
            </li>
        
    

    
    
        
            <li>
        

        
        <a href="/tags/#七牛">七牛</a>

        
    

    
    
        

        
        <a href="/tags/#yahoo">yahoo</a>

        
    

    
    
        

        
        <a href="/tags/#wget">wget</a>

        
            </li>
        
    

    
    
        
            <li>
        

        
        <a href="/tags/#webstorm">webstorm</a>

        
    

    
    
        

        
        <a href="/tags/#web">web</a>

        
    

    
    
        

        
        <a href="/tags/#vpn">vpn</a>

        
            </li>
        
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    


                </ul>

            </div>
            <div class="font-widget footer-fifth foot-conte">
                <h2>网站导航</h2>
                <ul>
                    <!-- 公共用菜单 -->
                    <li><a href="#">技术专区</a></li>
<li><a href="#">日志随笔</a></li>
<li><a href="/reading/">阅读书籍</a></li>
<!--li><a href="#">常用资源</a></li-->
<li><a href="/time/">时光轴</a></li>
<li><a href="/guest/">留言板</a></li>
<!--li><a href="/about/">个人介绍</a></li-->
                </ul>
            </div>
        </div>
        <div class="copyright">
            版权所有，保留一切权利！
			<span>
				<script async="true" type="text/javascript">
					var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
					document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fde8f68407bbc165071d066f45c6005fc' type='text/javascript'%3E%3C/script%3E"));
				</script>
			</span>
        </div>
    </div>
<div style="display: none;" id="rocket-to-top">
	<div style="display: block; opacity: 0;" class="level-2"></div>
	<div class="level-3"></div>
</div>
<script type="text/javascript" src="/resources/js/prettify.js"></script>
<script type="text/javascript" src="/resources/js/core.js"></script>
<script type="text/javascript">
	var duoshuoQuery = {short_name:"jcore"};
	(function() {
		var ds = document.createElement('script');
		ds.charset = 'UTF-8';
		ds.type = 'text/javascript';ds.async = true;
		//ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.src = '/resources/duoshuo/duoshuo.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>


</body>

</html>
